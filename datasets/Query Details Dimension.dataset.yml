unique_name: Query Details Dimension.dataset
object_type: dataset
label: Query Details Dimension
connection_id: snowflake_partner.connection
sql: |-
  SELECT
    QUERY_ID,
    QUERY_TAG,
    QUERY_TEXT,
    QUERY_TYPE,
    CASE WHEN CHARINDEX('queryId', QUERY_TEXT) > 0 THEN 1 ELSE 0 END AS ATSCALE_QUERY_FLAG,
    REGEXP_SUBSTR(QUERY_TEXT, '/\\*\\s*username=([^*\\s]+)\\s*\\*/', 1, 1, 'e', 1) AS ATSCALE_USERNAME,
    REGEXP_SUBSTR(QUERY_TEXT, '/\\*\\s*queryId=([0-9a-fA-F-]{36})\\s*\\*/', 1, 1, 'e', 1) AS ATSCALE_QUERY_ID
  FROM SNOWFLAKE.ACCOUNT_USAGE.QUERY_HISTORY

columns:
  - name: ATSCALE_QUERY_FLAG
    data_type: "decimal(1,0)"
  - name: ATSCALE_QUERY_ID
    data_type: string
  - name: ATSCALE_USERNAME
    data_type: string
  - name: QUERY_ID
    data_type: string
  - name: QUERY_TAG
    data_type: string
  - name: QUERY_TEXT
    data_type: string
  - name: QUERY_TYPE
    data_type: string
